I"£}<h1 id="lab-4-2-load-data">Lab 4-2: Load Data</h1>

<p>Author: Seungjae Lee (Ïù¥ÏäπÏû¨)</p>

<div class="alert alert-warning">
    We use elemental PyTorch to implement linear regression here. However, in most actual applications, abstractions such as <code>nn.Module</code> or <code>nn.Linear</code> are used.
</div>

<h2 id="slicing-1d-array">Slicing 1D Array</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1, 2, 3, 4]
</code></pre></div></div>

<p>index 2ÏóêÏÑú 4 Ï†ÑÍπåÏßÄ Í∞ÄÏ†∏ÏôÄÎùº. (Ïïû Ìè¨Ìï®, Îí§ ÎπÑÌè¨Ìï®)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2, 3]
</code></pre></div></div>

<p>index 2Î∂ÄÌÑ∞ Îã§ Í∞ÄÏ†∏ÏôÄÎùº.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2, 3, 4]
</code></pre></div></div>

<p>index 2 Ï†ÑÍπåÏßÄ Í∞ÄÏ†∏ÏôÄÎùº. (Ïó≠Ïãú Îí§Îäî ÎπÑÌè¨Ìï®)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1]
</code></pre></div></div>

<p>Ï†ÑÎ∂Ä Í∞ÄÏ†∏ÏôÄÎùº</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">[:])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1, 2, 3, 4]
</code></pre></div></div>

<p>ÎßàÏßÄÎßâ index Ï†ÑÍπåÏßÄ Í∞ÄÏ†∏ÏôÄÎùº. (Îí§Îäî ÎπÑÌè¨Ìï®!)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1, 2, 3]
</code></pre></div></div>

<p>assign ÎèÑ Í∞ÄÎä•!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nums</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1, 8, 9, 4]
</code></pre></div></div>

<h2 id="slicing-2d-array">Slicing 2D Array</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[ 1  2  3  4]
 [ 5  6  7  8]
 [ 9 10 11 12]]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([ 2,  6, 10])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([ 9, 10, 11, 12])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([ 9, 10, 11, 12])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">...]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([ 9, 10, 11, 12])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[1, 2, 3, 4],
       [5, 6, 7, 8]])
</code></pre></div></div>

<h2 id="loading-data-from-csv-file">Loading Data from <code class="language-plaintext highlighter-rouge">.csv</code> file</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">'data-01-test-score.csv'</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">xy</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[ 73.,  80.,  75., 152.],
       [ 93.,  88.,  93., 185.],
       [ 89.,  91.,  90., 180.],
       [ 96.,  98., 100., 196.],
       [ 73.,  66.,  70., 142.],
       [ 53.,  46.,  55., 101.],
       [ 69.,  74.,  77., 149.],
       [ 47.,  56.,  60., 115.],
       [ 87.,  79.,  90., 175.],
       [ 79.,  70.,  88., 164.],
       [ 69.,  70.,  73., 141.],
       [ 70.,  65.,  74., 141.],
       [ 93.,  95.,  91., 184.],
       [ 79.,  80.,  73., 152.],
       [ 70.,  73.,  78., 148.],
       [ 93.,  89.,  96., 192.],
       [ 78.,  75.,  68., 147.],
       [ 81.,  90.,  93., 183.],
       [ 88.,  92.,  86., 177.],
       [ 78.,  83.,  77., 159.],
       [ 82.,  86.,  90., 177.],
       [ 86.,  82.,  89., 175.],
       [ 78.,  83.,  85., 175.],
       [ 76.,  83.,  71., 149.],
       [ 96.,  93.,  95., 192.]], dtype=float32)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x_data</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_data</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">x_data</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># x_data shape
</span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span>  <span class="c1"># x_data Í∏∏Ïù¥
</span><span class="k">print</span><span class="p">(</span><span class="n">x_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>   <span class="c1"># Ï≤´ Îã§ÏÑØ Í∞ú
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(25, 3)
25
[[ 73.  80.  75.]
 [ 93.  88.  93.]
 [ 89.  91.  90.]
 [ 96.  98. 100.]
 [ 73.  66.  70.]]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">y_data</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># y_data shape
</span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>  <span class="c1"># y_data Í∏∏Ïù¥
</span><span class="k">print</span><span class="p">(</span><span class="n">y_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>   <span class="c1"># Ï≤´ Îã§ÏÑØ Í∞ú
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(25, 1)
25
[[152.]
 [185.]
 [180.]
 [196.]
 [142.]]
</code></pre></div></div>

<h2 id="imports">Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="n">optim</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For reproducibility
</span><span class="n">torch</span><span class="p">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;torch._C.Generator at 0x403df41ef0&gt;
</code></pre></div></div>

<h2 id="low-level-implementation">Low-level Implementation</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Îç∞Ïù¥ÌÑ∞
</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
<span class="c1"># Î™®Îç∏ Ï¥àÍ∏∞Ìôî
</span><span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># optimizer ÏÑ§Ï†ï
</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">SGD</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">nb_epochs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    
    <span class="c1"># H(x) Í≥ÑÏÇ∞
</span>    <span class="n">hypothesis</span> <span class="o">=</span> <span class="n">x_train</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="c1"># or .mm or @
</span>
    <span class="c1"># cost Í≥ÑÏÇ∞
</span>    <span class="n">cost</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">mean</span><span class="p">((</span><span class="n">hypothesis</span> <span class="o">-</span> <span class="n">y_train</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># costÎ°ú H(x) Í∞úÏÑ†
</span>    <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">cost</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>

    <span class="c1"># 100Î≤àÎßàÎã§ Î°úÍ∑∏ Ï∂úÎ†•
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Epoch {:4d}/{} Cost: {:.6f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">epoch</span><span class="p">,</span> <span class="n">nb_epochs</span><span class="p">,</span> <span class="n">cost</span><span class="p">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epoch    0/20 Cost: 26811.960938
Epoch    1/20 Cost: 9920.529297
Epoch    2/20 Cost: 3675.299072
Epoch    3/20 Cost: 1366.261108
Epoch    4/20 Cost: 512.542236
Epoch    5/20 Cost: 196.896484
Epoch    6/20 Cost: 80.190910
Epoch    7/20 Cost: 37.038647
Epoch    8/20 Cost: 21.081354
Epoch    9/20 Cost: 15.178741
Epoch   10/20 Cost: 12.993667
Epoch   11/20 Cost: 12.183028
Epoch   12/20 Cost: 11.880545
Epoch   13/20 Cost: 11.765955
Epoch   14/20 Cost: 11.720857
Epoch   15/20 Cost: 11.701424
Epoch   16/20 Cost: 11.691505
Epoch   17/20 Cost: 11.685121
Epoch   18/20 Cost: 11.680006
Epoch   19/20 Cost: 11.675381
Epoch   20/20 Cost: 11.670943
</code></pre></div></div>

<h2 id="high-level-implementation-with-nnmodule">High-level Implementation with <code class="language-plaintext highlighter-rouge">nn.Module</code></h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MultivariateLinearRegressionModel</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Îç∞Ïù¥ÌÑ∞
</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
<span class="c1"># Î™®Îç∏ Ï¥àÍ∏∞Ìôî
</span><span class="n">model</span> <span class="o">=</span> <span class="n">MultivariateLinearRegressionModel</span><span class="p">()</span>
<span class="c1"># optimizer ÏÑ§Ï†ï
</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">nb_epochs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_epochs</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="c1"># H(x) Í≥ÑÏÇ∞
</span>    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
    
    <span class="c1"># cost Í≥ÑÏÇ∞
</span>    <span class="n">cost</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># costÎ°ú H(x) Í∞úÏÑ†
</span>    <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">cost</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
    
    <span class="c1"># 20Î≤àÎßàÎã§ Î°úÍ∑∏ Ï∂úÎ†•
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Epoch {:4d}/{} Cost: {:.6f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">epoch</span><span class="p">,</span> <span class="n">nb_epochs</span><span class="p">,</span> <span class="n">cost</span><span class="p">.</span><span class="n">item</span><span class="p">()</span>
    <span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epoch    0/20 Cost: 2560.803955
Epoch    1/20 Cost: 955.054138
Epoch    2/20 Cost: 361.360779
Epoch    3/20 Cost: 141.852600
Epoch    4/20 Cost: 60.690659
Epoch    5/20 Cost: 30.679520
Epoch    6/20 Cost: 19.580132
Epoch    7/20 Cost: 15.472973
Epoch    8/20 Cost: 13.950972
Epoch    9/20 Cost: 13.384814
Epoch   10/20 Cost: 13.172079
Epoch   11/20 Cost: 13.089987
Epoch   12/20 Cost: 13.056224
Epoch   13/20 Cost: 13.040330
Epoch   14/20 Cost: 13.031028
Epoch   15/20 Cost: 13.024179
Epoch   16/20 Cost: 13.018215
Epoch   17/20 Cost: 13.012632
Epoch   18/20 Cost: 13.007132
Epoch   19/20 Cost: 13.001721
Epoch   20/20 Cost: 12.996302
</code></pre></div></div>

<h2 id="dataset-and-dataloader">Dataset and DataLoader</h2>

<div class="alert alert-warning">
    pandas Í∏∞Ï¥àÏßÄÏãùÏù¥ ÌïÑÏöîÌï† Í≤É Í∞ôÎã§
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="k">class</span> <span class="nc">CustomDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">x_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">73</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">75</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">93</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">93</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">73</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">70</span><span class="p">]]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">y_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">152</span><span class="p">],[</span><span class="mi">185</span><span class="p">],[</span><span class="mi">180</span><span class="p">],[</span><span class="mi">196</span><span class="p">],[</span><span class="mi">142</span><span class="p">]]</span>
        
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">x_data</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idx</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">x_data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">y_data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
    
<span class="n">dataset</span> <span class="o">=</span> <span class="n">CustomDataset</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nb_epochs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_epochs</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">samples</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
        <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">samples</span>
        
        <span class="c1"># H(x) Í≥ÑÏÇ∞
</span>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
    
        <span class="c1"># cost Í≥ÑÏÇ∞
</span>        <span class="n">cost</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
        <span class="c1"># costÎ°ú H(x) Í∞úÏÑ†
</span>        <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">cost</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
    
        <span class="c1"># 20Î≤àÎßàÎã§ Î°úÍ∑∏ Ï∂úÎ†•
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'Epoch {:4d}/{} Batch {}/{} Cost: {:.6f}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">epoch</span><span class="p">,</span> <span class="n">nb_epochs</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">),</span><span class="n">cost</span><span class="p">.</span><span class="n">item</span><span class="p">()</span>
        <span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epoch    0/20 Batch 1/2 Cost: 1213.129395
Epoch    0/20 Batch 2/2 Cost: 612.548767
Epoch    1/20 Batch 1/2 Cost: 175.380692
Epoch    1/20 Batch 2/2 Cost: 1560.875854
Epoch    2/20 Batch 1/2 Cost: 1128.105835
Epoch    2/20 Batch 2/2 Cost: 700.591919
Epoch    3/20 Batch 1/2 Cost: 1312.350464
Epoch    3/20 Batch 2/2 Cost: 523.178833
Epoch    4/20 Batch 1/2 Cost: 158.718887
Epoch    4/20 Batch 2/2 Cost: 1600.766357
Epoch    5/20 Batch 1/2 Cost: 47.131451
Epoch    5/20 Batch 2/2 Cost: 1473.253296
Epoch    6/20 Batch 1/2 Cost: 1142.540039
Epoch    6/20 Batch 2/2 Cost: 601.339172
Epoch    7/20 Batch 1/2 Cost: 1269.532349
Epoch    7/20 Batch 2/2 Cost: 556.251831
Epoch    8/20 Batch 1/2 Cost: 1.875856
Epoch    8/20 Batch 2/2 Cost: 1535.726562
Epoch    9/20 Batch 1/2 Cost: 292.746979
Epoch    9/20 Batch 2/2 Cost: 1490.381348
Epoch   10/20 Batch 1/2 Cost: 1089.752197
Epoch   10/20 Batch 2/2 Cost: 739.506897
Epoch   11/20 Batch 1/2 Cost: 1490.575195
Epoch   11/20 Batch 2/2 Cost: 45.611748
Epoch   12/20 Batch 1/2 Cost: 1255.198853
Epoch   12/20 Batch 2/2 Cost: 499.337097
Epoch   13/20 Batch 1/2 Cost: 191.701660
Epoch   13/20 Batch 2/2 Cost: 1562.451172
Epoch   14/20 Batch 1/2 Cost: 53.253944
Epoch   14/20 Batch 2/2 Cost: 1462.039917
Epoch   15/20 Batch 1/2 Cost: 343.420441
Epoch   15/20 Batch 2/2 Cost: 1401.213745
Epoch   16/20 Batch 1/2 Cost: 434.845764
Epoch   16/20 Batch 2/2 Cost: 1407.953125
Epoch   17/20 Batch 1/2 Cost: 1048.746094
Epoch   17/20 Batch 2/2 Cost: 785.950928
Epoch   18/20 Batch 1/2 Cost: 213.489975
Epoch   18/20 Batch 2/2 Cost: 1540.415405
Epoch   19/20 Batch 1/2 Cost: 57.037704
Epoch   19/20 Batch 2/2 Cost: 1455.791016
Epoch   20/20 Batch 1/2 Cost: 1414.848022
Epoch   20/20 Batch 2/2 Cost: 90.759705
</code></pre></div></div>

<p>ÎÑàÎ¨¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¨Î©¥ <code class="language-plaintext highlighter-rouge">x_data</code>, <code class="language-plaintext highlighter-rouge">y_data</code> Î•º Ï†ÑÎ∂Ä Îã§ Í∞ÄÏ†∏Ïò§ÏßÄ ÎßêÍ≥†, ÌïÑÏöîÌïú Î∞∞ÏπòÎßå Í∞ÄÏ†∏Ïò¨ Ïàò Î∞ñÏóê ÏóÜÎã§.</p>

<p><a href="https://pytorch.org/tutorials/beginner/data_loading_tutorial.html#iterating-through-the-dataset">PyTorch Data Loading and Processing tutorial</a></p>
:ET