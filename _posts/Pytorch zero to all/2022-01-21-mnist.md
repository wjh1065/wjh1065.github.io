---
title: "mnist"  
categories:
 - Pytorch zero to all
tags:
 - pytorch
---

```python
import torch
import torchvision.datasets as dsets
import torchvision.transforms as transforms
import matplotlib.pyplot as plt
import random
print(f"torch version : {torch.__version__} ")
```

    torch version : 1.10.0 



```python
device = 'cuda' if torch.cuda.is_available() else 'cpu'

random.seed(777)
torch.manual_seed(777)
if device == 'cuda':
    torch.cuda.manual_seed_all(777)
    
print(f"Used device : {device}")
```

    Used device : cpu



```python
training_epochs = 30
batch_size = 100

mnist_train = dsets.MNIST(root='MNIST_data/',
                         train = True,
                         transform = transforms.ToTensor(),
                         download  =True)
mnist_test = dsets.MNIST(root='MNIST_data/',
                         train = False,
                         transform = transforms.ToTensor(),
                         download  =True)

data_loader = torch.utils.data.DataLoader(dataset=mnist_train,
                                         batch_size = batch_size,
                                         shuffle = True,
                                         drop_last = True)
```

    Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to MNIST_data/MNIST/raw/train-images-idx3-ubyte.gz



      0%|          | 0/9912422 [00:00<?, ?it/s]


    Extracting MNIST_data/MNIST/raw/train-images-idx3-ubyte.gz to MNIST_data/MNIST/raw
    
    Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz to MNIST_data/MNIST/raw/train-labels-idx1-ubyte.gz



      0%|          | 0/28881 [00:00<?, ?it/s]


    Extracting MNIST_data/MNIST/raw/train-labels-idx1-ubyte.gz to MNIST_data/MNIST/raw
    
    Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz to MNIST_data/MNIST/raw/t10k-images-idx3-ubyte.gz



      0%|          | 0/1648877 [00:00<?, ?it/s]


    Extracting MNIST_data/MNIST/raw/t10k-images-idx3-ubyte.gz to MNIST_data/MNIST/raw
    
    Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz
    Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to MNIST_data/MNIST/raw/t10k-labels-idx1-ubyte.gz



      0%|          | 0/4542 [00:00<?, ?it/s]


    Extracting MNIST_data/MNIST/raw/t10k-labels-idx1-ubyte.gz to MNIST_data/MNIST/raw



    /opt/homebrew/Caskroom/miniforge/base/envs/DL-pytorch/lib/python3.8/site-packages/torchvision/datasets/mnist.py:498: UserWarning: The given NumPy array is not writeable, and PyTorch does not support non-writeable tensors. This means you can write to the underlying (supposedly non-writeable) NumPy array using the tensor. You may want to copy the array to protect its data or make it writeable before converting it to a tensor. This type of warning will be suppressed for the rest of this program. (Triggered internally at  /Users/runner/miniforge3/conda-bld/pytorch-recipe_1635217280611/work/torch/csrc/utils/tensor_numpy.cpp:189.)
      return torch.from_numpy(parsed.astype(m[2], copy=False)).view(*s)



```python
model = torch.nn.Linear(784, 10, bias=True).to(device)

criterion = torch.nn.CrossEntropyLoss().to(device)
optimizer = torch.optim.SGD(model.parameters(),lr=0.1)
```


```python
for epoch in range(training_epochs):
    avg_cost = 0
    total_batch = len(data_loader)
    
    for X, Y in data_loader:
        # print(X.shape) => torch.Size([100, 1, 28, 28])
        X = X.view(-1, 28*28).to(device)
        # print(X.shape) => torch.Size([100, 784])
        Y = Y.to(device)
        optimizer.zero_grad()
        hypothesis = model(X)
        cost = criterion(hypothesis, Y)
        cost.backward()
        optimizer.step()
        
        avg_cost += cost / total_batch
    
    print('Epoch : ', '%04d' % (epoch+1), 'cost = ', '{:.9f}'.format(avg_cost))

print('Learning finished')
```

    Epoch :  0001 cost =  0.535150588
    Epoch :  0002 cost =  0.359577715
    Epoch :  0003 cost =  0.331264287
    Epoch :  0004 cost =  0.316404670
    Epoch :  0005 cost =  0.307107031
    Epoch :  0006 cost =  0.300456554
    Epoch :  0007 cost =  0.294933408
    Epoch :  0008 cost =  0.290956169
    Epoch :  0009 cost =  0.287074089
    Epoch :  0010 cost =  0.284515589
    Epoch :  0011 cost =  0.281914055
    Epoch :  0012 cost =  0.279526860
    Epoch :  0013 cost =  0.277636588
    Epoch :  0014 cost =  0.275874764
    Epoch :  0015 cost =  0.274422735
    Epoch :  0016 cost =  0.272883624
    Epoch :  0017 cost =  0.271629602
    Epoch :  0018 cost =  0.270609766
    Epoch :  0019 cost =  0.269295037
    Epoch :  0020 cost =  0.268277347
    Epoch :  0021 cost =  0.267255515
    Epoch :  0022 cost =  0.266613424
    Epoch :  0023 cost =  0.265661448
    Epoch :  0024 cost =  0.264922351
    Epoch :  0025 cost =  0.263888687
    Epoch :  0026 cost =  0.263269752
    Epoch :  0027 cost =  0.262586147
    Epoch :  0028 cost =  0.261751622
    Epoch :  0029 cost =  0.261135817
    Epoch :  0030 cost =  0.260536879
    Learning finished



```python
with torch.no_grad():
    X_test = mnist_test.data.view(-1, 28*28).float().to(device)
    Y_test = mnist_test.targets.to(device)

    prediction = model(X_test)
    correct_prediction = torch.argmax(prediction, 1) == Y_test
    accuracy = correct_prediction.float().mean()
    print(f"Accuracy : {accuracy.item()}")
    
    r = random.randint(0, len(mnist_test) - 1)
    X_single_data = mnist_test.data[r:r+1].view(-1, 28*28).float().to(device)
    Y_single_data = mnist_test.targets[r:r+1].to(device)
    
    print('Label : ', Y_single_data.item())
    single_prediction = model(X_single_data)
    print('Prediction : ', torch.argmax(single_prediction, 1).item())
    
    plt.imshow(mnist_test.data[r:r+1].view(28,28), cmap='Greys', interpolation='nearest')
    plt.show()
```

    Accuracy : 0.8705000281333923
    Label :  2
    Prediction :  2




![mnist_5_1](https://user-images.githubusercontent.com/67947808/150461138-af565d44-2d8c-4aaa-9897-aeed054ac9f8.png)

â€‹    

